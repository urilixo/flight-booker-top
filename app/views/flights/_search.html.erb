<%= form_with url: '/', method: :get do |form| %>
  <% @airports = Airport.all %>
  <% @flights = Flight.all %>
  <% @days = Flight.all.map { |flight| flight.departure_time.day }.uniq %>
  <% @months = Flight.all.map { |flight| Date::MONTHNAMES[flight.departure_time.month] }.uniq %>
  <% @years = Flight.all.map { |flight| flight.departure_time.year }.uniq %>
  <%= form.label :from %>
  <%= form.collection_select :from, @airports, :id, :code %>
  <%= form.label :to %>
  <%= form.collection_select :to, @airports, :id, :code %>
  <%= form.label :day %>
  <%= form.select :day, @days  %>
  <%= form.label :month %>
  <%= form.select :month, @months  %>
  <%= form.label :year %>
  <%= form.select :year, @years  %>
  <%= form.label :passengers %>
  <%= form.select :passenger_count, 1..4  %>
  <%= form.submit 'Search' %>
<% end %>

<% if params[:from].present? %>
  <% no_flights = true %>
  <%= form_with url: new_booking_path, method: :get do |form| %>
    <%= form.hidden_field :passenger_count, value: params[:passenger_count] %>
    <% @date = "#{params[:year]}-#{params[:month].to_date.month}-#{params[:day]}".to_date %>
    <% @flights.each do |flight| %>
      <% if flight.departure_airport_id == params[:from].to_i &&
            flight.arrival_airport_id == params[:to].to_i && 
            flight.departure_time.to_date == @date %> 
        <% no_flights = false %>
        <%= form.label :selected_flight, "#{flight.departure_airport.code}  #{flight.arrival_airport.code} #{flight.departure_time}" %>
        <%= form.radio_button :selected_flight, flight.id %>
      <% end %>
    <% end %>
    <% if no_flights == true %>
      <%= "No flights found" %>
    <% end %>
    <%= form.submit 'Book' %>
  <% end %>
<% end %>